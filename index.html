<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>New York Times Search</title>
    <!-- Bootstrap CSS CDN  -->
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0/css/bootstrap.min.css" />

    <!-- Font Awesome CSS Icons (For cool glyphicons) -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" />

    <!-- Style to fix the issue of text extending past card length -->
    <link rel="stylesheet" href="css/style.css">
</head>

<body>

    <!-- Main Bootstrap Search -->
    <div class="container">

        <!-- Jumbotron for Title -->
        <div class="jumbotron">
            <h1 class="text-center header">Employee Data Management</h1>
            <p class="text-center">A Comprehensive Directory of Employee Billable Hours</p>
        </div>

        <!-- This row will handle all of the retrieved articles -->
        <div class="row">
            <div class="col-sm-12">
                <br>

                <!-- This card will initially be made up of a card and wells for each of the articles retrieved -->
                <div class="card">

                    <!-- card Heading for the retrieved articles box -->
                    <div class="card-header">
                        <strong> Current Employees</strong>
                    </div>

                    <!-- This main card will hold each of the resulting articles -->
                    <div class="card-body" id="article-section">
                        <table class="table">
                            <tr>
                                <th scope="col">Employee Name</th>
                                <th scope="col">Role</th>
                                <th scope="col">Start Date</th>
                                <th scope="col">Month Worked</th>
                                <th scope="col">Monthly Rate</th>
                                <th scope="col">Total Billed ($)</th>
                            </tr>

                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Row for Searching New York Times -->
        <div class="row">
            <div class="col-sm-12">
                <br>
                <!-- First card is for handling the search parameters -->
                <div class="card">
                    <div class="card-header">
                        <strong>Add Employee</strong>
                    </div>
                    <div class="card-body">

                        <!-- Here we create an HTML Form for handling the inputs-->
                        <form role="form">

                            <!-- Here we create the text box for capturing the search term-->
                            <div class="form-group">
                                <label for="employee"> Employee Name</label>
                                <input type="text" class="form-control" id="employee">
                            </div>

                            <!-- Here we capture the number of records that the user wants to retrieve  -->
                            <div class="form-group">
                                <label for="role">Role</label>
                                <input type="text" class="form-control" id="role">
                            </div>

                            <!-- Here we capture the Start Year Parameter-->
                            <div class="form-group">
                                <label for="start-date">Start Date (DD/MM/YY)</label>
                                <input type="text" class="form-control" id="start-date">
                            </div>

                            <!-- Here we capture the End Year Parameter -->
                            <div class="form-group">
                                <label for="monthly-rate">Monthly Rate</label>
                                <input type="text" class="form-control" id="monthly-rate">
                            </div>

                            <!-- Here we have our final submit button -->
                            <button type="submit" class="btn btn-default" id="add-employee">Submit</button>

                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- jQuery JS -->
    <script src="https://code.jquery.com/jquery.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0/js/bootstrap.bundle.min.js"></script>

    <!-- Link for MomentJS -->
    <script src="https://momentjs.com/downloads/moment.min.js"></script>

    <!-- LINKS FOR FIREBASE GO HERE -->
    <script src="https://www.gstatic.com/firebasejs/6.0.4/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/6.0.4/firebase-database.js"></script>

    <!-- Code to the JavaScript File -->
    <script>
        //  START CODING BELOW!!

        // Initialize Firebase
        var firebaseConfig = {
            apiKey: "AIzaSyCHXbOaEMjx56hbJn5ADsZ5F1dV_xIEA3w",
            authDomain: "first-firebase-9ef02.firebaseapp.com",
            databaseURL: "https://first-firebase-9ef02.firebaseio.com",
            projectId: "first-firebase-9ef02",
            storageBucket: "",
            messagingSenderId: "1095045499134",
            appId: "1:1095045499134:web:c835de193f57beaf"
        };

        firebase.initializeApp(firebaseConfig);

        // Create a variable to reference the database
        var database = firebase.database();
        var employee = "";
        var role = "";
        var date = "";
        var rate = 0;

        // Capture Button Click
        $("#add-employee").on("click", function (event) {
            // Don't refresh the page!
            event.preventDefault();

            // Code in the logic for storing and retrieving the most recent user.
            // Get inputs
            var data = {
                employee: $("#employee").val().trim(),
                role: $("#role").val().trim(),
                date: $("#start-date").val().trim(),
                rate: $("#monthly-rate").val().trim(),
                dateAdded: firebase.database.ServerValue.TIMESTAMP
            }

            database.ref().push(data);

            // Don't forget to provide initial data to your Firebase database.

        });
        // Firebase watcher + initial loader HINT: .on("value")
        database.ref().on("child_added", function (childSnapshot) {
            // Print the initial data to the console.
            console.log(childSnapshot.val());

            // Log the value of the various properties
            console.log(childSnapshot.val().employee);
            console.log(childSnapshot.val().role);
            console.log(childSnapshot.val().date);
            console.log(childSnapshot.val().rate);

            var employee_display = $("<td>").text(childSnapshot.val().employee);
            var role_display = $("<td>").text(childSnapshot.val().role);
            var start_date_display = $("<td>").text(childSnapshot.val().date);
            var monthly_rate_display = $("<td>").text(childSnapshot.val().rate);
            var months_worked = Math.abs(moment(childSnapshot.val().date).diff(moment(), "months"));
            //console.log(months_worked);
            var monthly_worked_display = $("<td>").text(months_worked);
            var billed = months_worked * childSnapshot.val().rate;
            var billed_display = $("<td>").text(billed);
            var row = $("<tr>");
            row.append(employee_display, role_display, start_date_display, monthly_worked_display, monthly_rate_display, billed_display);
            $(".table").append(row);

            // Create Error Handling
        }, function (errorObject) {
            console.log("The read failed: " + errorObject.code);
        });

    </script>

</body>

</html>